<h1><%= @design.title %></h1>
<p><%= @design.description %></p>
<br>

<%= image_tag @design.picture if @design.picture.attached? %>
<br>

<%= form_with model: @order, local: true do |form| %>
    <div>
        <%= form.label :address %>
        <%= form.text_field :address %>
    </div>
    <div>
        <%= form.label :comment %>
        <%= form.text_area :comment %>
    </div>
    <div>
        <%= form.label :shirt_size %>
        <%= form.select(:shirt_size, options_for_select(["S", "M", "L", "XL"])) %>
    </div>
    <div>
        <%= hidden_field_tag(:user_id, design.user_id) %>
    </div>
    <div>
        <%= hidden_field_tag(:design_id, design_id) %>
    </div>
    <div>
        <%= form.submit %>
    </div>
<% end %>

<button data-stripe="payment">Pay Deposit <%= number_to_currency(30) %></button>

<script src="https://js.stripe.com/v3/"></script>

<script>
  document
    .querySelector("[data-stripe='payment']")
    .addEventListener("click", () => {
      const stripe = Stripe(
        "<%= Rails.application.credentials.dig(:stripe, :public_key) %>"
      );

      stripe.redirectToCheckout({
        sessionId: "<%= @session_id %>"
      });
    });
</script>

<br>

<%= link_to "Return to collections", collections_path%>

